<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Year in progress</title>
    <meta name="description" content="A year progress bar to remind us that time moves whether we do or not.">
    <meta name="author" content="Steve Fox">


</head>

<body>
    <script>

        // choices
        var titleBefore = false;
        var titleBeforeText = "Year in progress: ";
        var titleAfterText = "% of year elapsed";
        let decimalPlaces = 5; // recommend 1 to 5, 0 rounds up, 5 lets you see some nice movement


        const currentYear = new Date().getFullYear();
        changeTitle();                                      // sets the title so there is no delay

        window.onload = function newUpdate() {
            update = setInterval(changeTitle, 800);
        }



        function changeTitle() {
            // change title, formatted either before or after style
            titleBefore ? document.title = titleBeforeText + getYearProgress() + '%' : document.title = getYearProgress() + titleAfterText;
        }


        function isLeapYear() {
            // returns true or false depending on the conditions being met
            // exactly divisible by 4 but not 100 OR exactly divisible by 100
            return ((currentYear % 4 == 0) && (currentYear % 100 != 0)) || (currentYear % 400 == 0);
        }


        function getTotalDays() {
            const leapYearDays = 366;
            const normalYearDays = 365;

            // if true, returns 366 else returns 365
            return isLeapYear() ? leapYearDays : normalYearDays;
        }


        function getYearProgress() {

            var now = new Date();
            var yearStart = new Date(currentYear, 0, 1);
            var yearElapsed = now - yearStart;

            // the days need to be multiplied by 24 hours, 60 mins, 60 seconds and 1000 milliseconds so we are using the same units
            // multiply by 100 so it's expressed as a percentage
            yearElapsedPercentage = (yearElapsed / (getTotalDays() * 24 * 60 * 60 * 1000)) * 100;

            return yearElapsedPercentage.toFixed(decimalPlaces);
        }
    </script>
</body>

</html>